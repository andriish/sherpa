@node Tips and Tricks
@chapter Tips and Tricks

@menu
* Bash completion:: How to add bash completion for Sherpa parameters
* Rivet analyses:: How to analyse Sherpa events using Rivet
* Debugging a crashing/stalled event::  How to recover the random seed for an event that is hanging or crashing
* Versioned installation:: How to install multiple Sherpa versions in the same prefix.
* NLO calculations::  How to efficiently perform NLO calculations
@end menu

@node Bash completion
@section Bash completion

Sherpa will install a file named
@samp{$prefix/share/SHERPA-MC/sherpa-completion} which contains tab completion
functionality for the bash shell. You simply have to source it in your active
shell session by running
@verbatim
  .  $prefix/share/SHERPA-MC/sherpa-completion
@end verbatim

and you will be able to tab-complete any parameters on a Sherpa
command line.

To permanently enable this feature in your bash shell, you'll have to add the
source command above to your ~/.bashrc.


@node Rivet analyses
@section Rivet analyses
@cindex ANALYSIS_OUTPUT

Sherpa is equipped with an interface to the analysis tool Rivet. To enable it,
Rivet and HepMC have to be installed (e.g. using the Rivet bootstrap script)
and your Sherpa compilation has to be configured with the following options:
@verbatim
  ./configure --enable-hepmc2=/path/to/hepmc2 --enable-rivet=/path/to/rivet
@end verbatim

(Note: Both paths are equal if you used the Rivet bootstrap script.)

To use the interface, specify the switch
@verbatim
  Sherpa ANALYSIS=Rivet
@end verbatim

and create an analysis section in @code{Run.dat} that reads as follows:
@verbatim
  (analysis){
    BEGIN_RIVET {
      -a D0_2008_S7662670 CDF_2007_S7057202 D0_2004_S5992206 CDF_2008_S7828950
    } END_RIVET
  }(analysis)
@end verbatim

The line starting with @code{-a} specifies which Rivet analyses to run and the
histogram output file can be changed with the normal @code{ANALYSIS_OUTPUT}
switch.

You can also use @code{AddOns/Rivet/make-html} to create webpages from Rivet's
output files:
@verbatim
  (source /path/to/rivetenv.sh)   # see below
  AddOns/Rivet/make-html -o output/ file1.aida [file2.aida, ...]
  firefox output/index.html &
@end verbatim

If your Rivet installation is not in a standard location, the bootstrap script
should have created a @code{rivetenv.sh} which you have to source before running
the @code{make-html} script.

@node Debugging a crashing/stalled event
@section Debugging a crashing/stalled event

@subsection Crashing events
If an event crashes, Sherpa tries to obtain all the information needed to
reproduce that event and writes it out into a directory named
@verbatim
  Status__<date>_<time>
@end verbatim

If you are a Sherpa user and want to report this crash to the Sherpa team,
please attach a tarball of this directory to your email. This allows us to
reproduce your crashed event and debug it.

To debug it yourself, you can follow these steps
(Only do this if you are a Sherpa developer, or want to debug a problem
in an addon library created by yourself):
@itemize

@item Copy the random seed out of the status directory into your run path:
@verbatim
  cp  Status__<date>_<time>/random.dat  ./
@end verbatim

@item Run your normal Sherpa commandline with an additional parameter:
@verbatim
  Sherpa [...] STATUS_PATH=./
@end verbatim

Sherpa will then read in your random seed from ``./random.dat'' and
generate events from it.

@item Ideally, the first event will lead to the crash you saw earlier, and
you can now turn on debugging output to find out more about the details
of that event and test code changes to fix it:
@verbatim
  Sherpa [...] OUTPUT=15 STATUS_PATH=./
@end verbatim
@end itemize

@subsection Stalled events
If event generation seems to stall, you first have to find out
the number of the current event. For that you would terminate the stalled
Sherpa process (using Ctrl-c) and check in its final output for the number
of generated events.
Now you can request Sherpa to write out the random seed for the event before the
stalled one:
@verbatim
  Sherpa [...] EVENTS=[#events - 1] SAVE_STATUS=Status/
@end verbatim

(Replace [#events - 1] using the number you figured out earlier)

The created status directory can either be sent to the Sherpa developers,
or be used in the same steps as above to reproduce that event and debug it.

@node Versioned installation
@section Versioned installation

If you want to install different Sherpa versions into the same prefix
(e.g. /usr/local), you have to enable versioning of the installed directories
by using the configure option @samp{--enable-versioning}.
Optionally you can even pass an argument to this parameter of what you want the
version tag to look like.

@include NLOtips.texi
