#!/bin/bash

NODES="ptpp90 ptpp91 ptpp92 ptpp93 ptpp86 ptpp87 ptpp88"
HOSTN=`hostname`

if [ "$1" = "local" ] ; then
  echo -en "\e[0m\e[32m"
  uptime
  echo -en "\e[0m\e[31m"
  PACS=`ps -fA | grep "Sherpa" | awk '{printf $2 "\n"}'` 
  for J in $PACS ; do 
  if test -d  /proc/$J; then 
    TUSER=`ls -ld /proc/$J/cmdline | awk '{printf $3}'`
    echo -en "\e[34m" 
    if [ $TUSER = $USER ]; then  
      ls -ld /proc/$J/cwd | awk '{printf $11 " :\n"}' 
    else 
      echo ---- 
    fi
    echo -en "\e[0m\e[31m" ; ps --no-headers -fp $J 
  fi
  done
  echo -en "\e[0m"
else 

echo -e "\e[34m\e[1mstatus report:\e[0m `date`"

for I in $NODES
do
 if [[ $HOSTN == $I ]]
 then
   echo -en "\e[1m$I (local) :\e[0m"
   $0 local
 else
  echo -en "\e[1m$I :\e[0m"
  ssh $I "cd $PWD; $0 local"
 fi
done
echo -en "\e[0m"

fi